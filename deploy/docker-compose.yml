version: "3"

services: 
    text-processor-0:
        image: text-processor
        build: 
            context: .
            dockerfile: Dockerfile
        container_name: text-processor-0
    
    text-processor-1:
        image: text-processor
        build: 
            context: .
            dockerfile: Dockerfile
        container_name: text-processor-1
    
    text-processor-2:
        image: text-processor
        build: 
            context: .
            dockerfile: Dockerfile
        container_name: text-processor-2
    
    text-processor-3:
        image: text-processor
        build: 
            context: .
            dockerfile: Dockerfile
        container_name: text-processor-3
    
    # Балансер нагрузки.
    # Параметры проксирования определены в Caddyfile
    text-processor-caddy:
        image: caddy:2.0.0-alpine
        container_name: text-processor-caddy
        restart: unless-stopped
        ports:
        - '9555:8080'
        volumes:
        - ./Caddyfile:/etc/caddy/Caddyfile
        - ./www:/www

# outer network to communicate with other services 
networks:
    default:
        external:
            name: auth_proxy_network